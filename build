#!/bin/bash
set -e

docker rm -f feedread &>/dev/null && echo 'Removed old container'
docker rmi feedread &>/dev/null && echo 'Removed old image'

# make image
docker build -t feedread .
docker rmi `docker images --filter label=stage=builder -q`


[[ -f grab.log ]] || touch grab.log
[[ -f feedread.sqlite3 ]] || cp feedread.example.sqlite3 feedread.sqlite3

docker run -idt \
-v $(pwd)/feedread.sqlite3:/app/feedread.sqlite3 \
-v $(pwd)/grab.log:/app/grab.log \
--name feedread -p 3008:80 feedread
